<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conditional Threading Optimizer â€¢ rco</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Conditional Threading Optimizer">
<meta property="og:description" content="rco">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rco</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Optimizers
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/opt-common-subexpr.html">Common Subexpression Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-cond-thread.html">Conditional Threading</a>
    </li>
    <li>
      <a href="../articles/opt-constant-folding.html">Constant Folding</a>
    </li>
    <li>
      <a href="../articles/opt-constant-propagation.html">Constant Propagation</a>
    </li>
    <li>
      <a href="../articles/opt-dead-code.html">Dead Code Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-dead-expr.html">Dead Expression Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-dead-store.html">Dead Store Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-loop-invariant.html">Loop-invariant Code Motion</a>
    </li>
    <li>
      <a href="../articles/opt-memory-alloc.html">Memory Allocation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/contributing-an-optimizer.html">Contributing an Optimizer</a>
    </li>
    <li>
      <a href="../articles/potential-optimizers.html">Potential Optimizers</a>
    </li>
    <li>
      <a href="../articles/docker-readme.html">Docker Image</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jcrodriguez1989/rco/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="opt-cond-thread_files/header-attrs-2.5/header-attrs.js"></script><link href="opt-cond-thread_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="opt-cond-thread_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Conditional Threading Optimizer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jcrodriguez1989/rco/blob/master/vignettes/opt-cond-thread.Rmd"><code>vignettes/opt-cond-thread.Rmd</code></a></small>
      <div class="hidden name"><code>opt-cond-thread.Rmd</code></div>

    </div>

    
    
<div id="conditional-threading-optimizer" class="section level1">
<h1 class="hasAnchor">
<a href="#conditional-threading-optimizer" class="anchor"></a>Conditional Threading Optimizer</h1>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>Conditional Threading is an optimization that searches for separate blocks of <code>IF</code> statements but with exactly the same conditions. When several conditionals present the same boolean condition, merging their inside actions would avoid computing the condition several times. Also, in the cases where a second <code>IF</code> statement has been used with the exact negation of the condition of the first <code>IF</code>, the second <code>IF</code> could then be incorporated in an <code>ELSE</code> statement.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Consider the following example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>
  <span class="st">"n_evens &lt;- 0"</span>,
  <span class="st">"n_odds &lt;- 0"</span>,
  <span class="st">"odds_sum &lt;- 0"</span>,
  <span class="st">"evens_sum &lt;- 0"</span>,
  <span class="st">""</span>,
  <span class="st">"for (i in sample(10000, replace = TRUE)) {"</span>,
  <span class="st">"  if (i %% 2 == 1) {"</span>,
  <span class="st">"    n_odds &lt;- n_odds + 1"</span>,
  <span class="st">"  }"</span>,
  <span class="st">"  if (i %% 2 == 1) {"</span>,
  <span class="st">"    odds_sum &lt;- odds_sum + i"</span>,
  <span class="st">"  }"</span>,
  <span class="st">"  if (!(i %% 2 == 1)) {"</span>,
  <span class="st">"    n_evens &lt;- n_evens + 1"</span>,
  <span class="st">"  }"</span>,
  <span class="st">"  if (!(i %% 2 == 1)) {"</span>,
  <span class="st">"    evens_sum &lt;- evens_sum + i"</span>,
  <span class="st">"  }"</span>,
  <span class="st">"}"</span>,
  sep <span class="op">=</span> <span class="st">"\n"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span></code></pre></div>
<pre><code>## n_evens &lt;- 0
## n_odds &lt;- 0
## odds_sum &lt;- 0
## evens_sum &lt;- 0
## 
## for (i in sample(10000, replace = TRUE)) {
##   if (i %% 2 == 1) {
##     n_odds &lt;- n_odds + 1
##   }
##   if (i %% 2 == 1) {
##     odds_sum &lt;- odds_sum + i
##   }
##   if (!(i %% 2 == 1)) {
##     n_evens &lt;- n_evens + 1
##   }
##   if (!(i %% 2 == 1)) {
##     evens_sum &lt;- evens_sum + i
##   }
## }</code></pre>
<p>Then, the automatically optimized code would be:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">opt_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opt_cond_thread.html">opt_cond_thread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">opt_code</span><span class="op">$</span><span class="va">codes</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## n_evens &lt;- 0
## n_odds &lt;- 0
## odds_sum &lt;- 0
## evens_sum &lt;- 0
## for (i in sample(10000, replace = TRUE)) {
## if(i %% 2 == 1) {
## n_odds &lt;- n_odds + 1
##  odds_sum &lt;- odds_sum + i
## }else {
##  n_evens &lt;- n_evens + 1
##  evens_sum &lt;- evens_sum + i
## }}</code></pre>
<p>And if we measure the execution time of each one, and the speed-up:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bmark_res</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="op">(</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">code</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>, <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">opt_code</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="fu">autoplot</span><span class="op">(</span><span class="va">bmark_res</span><span class="op">)</span></code></pre></div>
<p><img src="opt-cond-thread_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">speed_up</span><span class="op">(</span><span class="va">bmark_res</span><span class="op">)</span></code></pre></div>
<pre><code>##            Min.  1st Qu.   Median     Mean  3rd Qu.     Max.
## Expr_2 212.6976 206.8032 195.1441 201.1962 210.8124 190.4774</code></pre>
</div>
<div id="implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h2>
<p>The <code>opt-cond-thread</code> optimizer simply looks for <code>IF</code> statements in the code snippet given as the input and if it finds an <code>IF</code> statement, it checks the immediate next block of code. If it is another <code>IF</code> statement, the optimizer merges the two <code>IF</code> blocks if the <code>IF</code> conditions were same or converts the second <code>IF</code> statement to <code>ELSE</code> if the conditions were negation of each other.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Juan Cruz Rodriguez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
